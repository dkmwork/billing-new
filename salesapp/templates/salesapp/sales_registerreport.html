{% extends "billingapp/base.html" %}
{% block body_block %}
{% load custom_tags %}
<label>
    <h5>Sales Register Report</h5>
    </label>
<form method="GET">
    {% csrf_token %}
    <table class="table table-striped table-bordered table-sm">
        <tr>
        <th>SlNo</th>
        <th>InvDate</th>
        <th>Customer</th>
        <th>InvNo</th>
        <th>SlNo</th>
        <th>Item Name</th>
        <th>Qty</th>
        <th>UOM</th>
        <th>Unit Rate</th>
        <th>Disc Amnt</th>
        <th>Tax Amnt</th>
        <th>CGST</th>
        <th>SGST</th>
        <th>IGST</th>
        <th>Item Total</th>
        <th>G.Total</th>
        </tr>
        <tbody>
            {% regroup SalesItemsList by sales_no.invoice_date as firstlist %}
            {% for item in firstlist %}
            {% regroup item.list by sales_no.customer.party_name as secondlist %}
            <tr>
                <td>{{forloop.counterv}}</td>
                {% for seconditem in secondlist %}
                {% regroup seconditem.list by sales_no.sales_invoiceno as thirdlist %}
                {% if forloop.first %}
                <td>{{item.grouper|date:'d/m/Y'}}</td>
                {% else %}
                <td></td>
                <td></td>
                {% endif %}
                <td>{{seconditem.grouper}}</td>
                {% for thirditem in thirdlist %}
                {% if forloop.first %}
                <td>{{thirditem.grouper}}</td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>{{thirditem.list|find_Gtotal}}</td>
                {% else %}
                <td></td>
                <td></td>
                <td></td>
                <td>{{thirditem.grouper}}</td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>{{thirditem.list|find_Gtotal}}</td>
                {% endif %}
                </tr>
                {% for fourthitem in thirditem.list %}
                <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>{{forloop.counter}}</td>
                <td>{{fourthitem.sales_item.product_name}}</td>
                <td>{{fourthitem.salesitem_quantity}}</td>
                <td>{{fourthitem.sales_uom}}</td>
                <td>{{fourthitem.salesitem_rate}} </td>
                <td>{{fourthitem.salesitem_disc}}</td>
                <td>{{fourthitem.salesitem_taxable}}</td>
                <td>{{fourthitem.salesitem_CGSTamnt}}</td>
                <td>{{fourthitem.salesitem_SGSTamnt}}</td>
                <td>{{fourthitem.salesitem_IGSTamnt}}</td>
                <td>{{fourthitem.salesitem_amnt}}</td>
                <td></td>
                {% endfor %}
                </tr>
                {% endfor %}
                {% endfor %}
                {% endfor %}
        </tbody>
    </table>
</form>
{% endblock %}